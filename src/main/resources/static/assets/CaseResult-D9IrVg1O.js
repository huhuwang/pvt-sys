import{r as f,j as F,k as L,f as P,w as s,n as y,V as _,d as m,o as $,b as e,a as j,p as d,s as i,e as A,q as H}from"./index-BZWBJNRr.js";import{_ as O}from"./LoginOut-GI41O1go.js";const K={__name:"CaseResult",setup(E){const I=H(),x=f([]),u=f({}),o=f({});let g=f(!1);const b=f([{label:"PASS",value:1},{label:"NO PASS",value:2}]),R=a=>{if(a==1)return"ticket";if(a==2)return"health check"},C=a=>{switch(a){case 1:return"Urgent";case 2:return"Highest";case 3:return"High";case 4:return"Low";case 5:return"Lowest";case 6:return"Blocker";case 7:return"Critical";case 8:return"Major";case 9:return"Minor";case 10:return"Trivial"}},n=F({resultId:history.state.resultId,deploymentId:history.state.deploymentId,ticketId:history.state.ticketId,env:history.state.env,device:history.state.device,nextCase:null}),w=async()=>{await y.get(`result/query/${n.resultId}`).then(a=>{o.value=a,u.value=a.testCase,g.value=(a.category&4)>0,x.value=a.documents.map(({documentName:t,documentType:r,scaleSize:l,url:h,id:p})=>({name:t,type:r,size:l,url:h,documentId:p})),U()}).catch(a=>{_.modal.message({content:a,status:"error"})})},U=()=>{let a=f({});a.value.env=n.env,a.value.device=n.device,a.value.ticketNo=u.value.ticketNo,y.post("result/query/case",a.value).then(t=>{const r=t.findIndex(l=>l==n.resultId);r==t.length-1?n.nextCase=t[0]:n.nextCase=t[r+1]}).catch(t=>{_.modal.message({content:t,status:"error"})})},V=()=>{o.value.testCase.id=u.value.id,o.value.documents=x.value.map(({documentId:a,url:t})=>({id:a,url:t})),y.post("result/add",o.value).then(a=>{_.modal.message({content:"保存成功",status:"success"})}).catch(a=>{_.modal.message({content:a,status:"error"})})},D=()=>{const a={ticketNo:u.value.ticketNo,ticketId:n.ticketId};I.push({name:"case-list",state:a})},N=async({file:a,option:t})=>{const r=new FormData;r.append("file",a),r.append("resultId",n.resultId),r.append("deploymentId",n.deploymentId),await y.post("document/upload",r).then(l=>{t.url=l.url,t.documentId=l.id}).catch(l=>{_.modal.message({content:l,status:"error"})})},S=async({option:a})=>{await y.delete(`document/delete/${a.documentId}`).then(t=>{}).catch(t=>{_.modal.message({content:t,status:"error"})})},T=()=>{V(),n.resultId=n.nextCase,w()};return L(()=>{w()}),(a,t)=>{const r=m("vxe-layout-header"),l=m("vxe-form-item"),h=m("vxe-form"),p=m("vxe-textarea"),q=m("vxe-radio-group"),k=m("vxe-button"),z=m("vxe-upload"),M=m("vxe-layout-body"),B=m("vxe-layout-container");return $(),P(B,{vertical:""},{default:s(()=>[e(r,{fixed:"",style:{"background-color":"#a6c9ed"}},{default:s(()=>[e(O)]),_:1}),e(M,null,{default:s(()=>[j("div",null,[e(h,{border:"","title-background":"","vertical-align":"center","title-width":"120",data:u.value},{default:s(()=>[e(l,{title:"description",field:"description",span:"24"},{default:s(()=>[d(i(u.value.description),1)]),_:1}),e(l,{title:"summary",field:"summary",span:"24"},{default:s(()=>[d(i(u.value.summary),1)]),_:1}),e(l,{title:"expected result",field:"expectedResult",span:"24"},{default:s(()=>[d(i(u.value.expectedResult),1)]),_:1}),e(l,{title:"priority",field:"priority",span:"24"},{default:s(()=>[d(i(C(u.value.priority)),1)]),_:1}),e(l,{title:"reporter",field:"createUser",span:"24"},{default:s(()=>[d(i(u.value.createUser),1)]),_:1}),e(l,{title:"verifier",field:"updateUser",span:"24"},{default:s(()=>[d(i(u.value.updateUser),1)]),_:1}),e(l,{title:"type",field:"type",span:"24"},{default:s(()=>[d(i(R(u.value.type)),1)]),_:1}),e(l,{title:"env",field:"env",span:"24"},{default:s(()=>[d(i(o.value.env),1)]),_:1}),e(l,{title:"device",field:"device",span:"24"},{default:s(()=>[d(i(o.value.device),1)]),_:1}),e(l,{title:"RT flow",field:"rtFlow",span:"24",visible:A(g)},{default:s(()=>[d(i(o.value.rtFlow),1)]),_:1},8,["visible"])]),_:1},8,["data"]),e(h,{border:"","title-background":"","vertical-align":"center","title-width":"120",data:o.value,onSubmit:V},{default:s(()=>[e(l,{title:"step",field:"step",span:"24","item-render":{}},{default:s(v=>[e(p,{modelValue:o.value.step,"onUpdate:modelValue":t[0]||(t[0]=c=>o.value.step=c),placeholder:"test step",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(l,{title:"test data",field:"testData",span:"24","item-render":{}},{default:s(v=>[e(p,{modelValue:o.value.testData,"onUpdate:modelValue":t[1]||(t[1]=c=>o.value.testData=c),placeholder:"test data",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(l,{title:"actual result",field:"actualResult",span:"24","item-render":{}},{default:s(v=>[e(p,{modelValue:o.value.actualResult,"onUpdate:modelValue":t[2]||(t[2]=c=>o.value.actualResult=c),placeholder:"actual result",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(l,{title:"result",field:"result",span:"24","item-render":{}},{default:s(v=>[e(q,{modelValue:o.value.result,"onUpdate:modelValue":t[3]||(t[3]=c=>o.value.result=c),options:b.value},null,8,["modelValue","options"])]),_:1}),e(l,{title:"remark",field:"remark",span:"24","item-render":{}},{default:s(v=>[e(p,{modelValue:o.value.remark,"onUpdate:modelValue":t[4]||(t[4]=c=>o.value.remark=c),placeholder:"remark",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(l,{align:"center",span:"24","item-render":{}},{default:s(()=>[e(k,{type:"submit",status:"primary",content:"提交"}),e(k,{type:"reset",content:"重置"}),e(k,{content:"返回",onClick:D}),e(k,{content:"下一条",status:"primary",onClick:T})]),_:1})]),_:1},8,["data"]),e(z,{"key-field":"documentId",modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=v=>x.value=v),mode:"image","limit-count":15,multiple:"","show-progress":"","upload-method":N,"remove-method":S},null,8,["modelValue"])])]),_:1})]),_:1})}}};export{K as default};
