import{r as k,j as A,k as j,f as F,w as n,n as _,V as d,d as i,o as U,b as o,a as f,s as V,p as u,c as H,v as L,q as z}from"./index-C0HrLBRe.js";import{_ as G}from"./LoginOut-Cgiu3BLd.js";const J={class:"row-wrapper"},K={class:"mybg"},O={class:"mybg"},P={class:"mybg"},Q={key:0},Z={__name:"TicketList",setup(W){const h=z(),y=k(),N=k(),x=k(!1),c=A({deploymentId:history.state.deploymentId,applicationName:null,deploymentName:null,deploymentDate:null}),g=async()=>{x.value=!0,await _.get(`ticket/queryTicketByDeployment/${c.deploymentId}`).then(e=>{N.value=e}).catch(e=>{d.modal.message({content:e,status:"error"})}).finally(()=>{x.value=!1})},w=()=>{_.get(`deployment/query/${c.deploymentId}`).then(e=>{c.applicationName=e.applicationName,c.deploymentName=e.deploymentName,c.deploymentDate=e.deploymentDate}).catch(e=>{d.modal.message({content:e,status:"error"})})},$=async()=>{const e=y.value;e&&await d.modal.confirm("您确定要还原数据吗?")==="confirm"&&await e.revertData()},T=async()=>{const e=y.value;if(e){const{row:t}=await e.insertAt({});await e.setEditCell(t,"name")}},I=k({ticketNo:[{required:!0,message:"必须填写ticketNo"}],ticketTitle:[{required:!0,message:"必须填写ticket标题"}]}),D=async()=>{const e=y.value;if(e)if(await e.validate())d.modal.message({status:"error",content:"校验不通过！"});else{const{insertRecords:r,updateRecords:p}=e.getRecordset(),b=r.concat(p);_.post("ticket/add",b).then(s=>{d.modal.message({content:"保存成功",status:"success"}),g()}).catch(s=>{d.modal.message({content:s,status:"error"})})}},R=e=>{d.modal.confirm({title:"操作提示",content:"请您确认是否删除？",onConfirm:()=>{_.delete(`ticket/delete/${e}`,{}).then(t=>{d.modal.message({content:"删除成功",status:"success"}),g()}).catch(t=>{d.modal.message({content:t,status:"error"})})}})},q=e=>{const t={ticketNo:e.ticketNo,ticketId:e.id};h.push({name:"case-list",state:t})},C=(e,t)=>{_.get(`download/us?ticketNo=${e.ticketNo}&env=${t}`).then(r=>{d.saveFile({filename:e.ticketNo,type:"xlsx",content:r})}).catch(r=>{d.modal.message({content:r,status:"error"})})};return j(()=>{g(),w()}),(e,t)=>{const r=i("vxe-layout-header"),p=i("vxe-col"),b=i("vxe-row"),s=i("vxe-button"),E=i("vxe-toolbar"),v=i("vxe-input"),m=i("vxe-column"),B=i("vxe-table"),M=i("vxe-layout-body"),S=i("vxe-layout-container");return U(),F(S,{vertical:""},{default:n(()=>[o(r,{fixed:"",style:{"background-color":"#a6c9ed"}},{default:n(()=>[o(G)]),_:1}),o(M,null,{default:n(()=>[f("div",null,[f("div",J,[o(b,{gutter:"[100,100]"},{default:n(()=>[o(p,{span:"8"},{default:n(()=>[f("div",K,"应用: "+V(c.applicationName),1)]),_:1}),o(p,{span:"8"},{default:n(()=>[f("div",O,"发布名称:"+V(c.deploymentName),1)]),_:1}),o(p,{span:"8"},{default:n(()=>[f("div",P,"发布时间:"+V(c.deploymentDate),1)]),_:1})]),_:1})]),o(E,null,{buttons:n(()=>[o(s,{onClick:t[0]||(t[0]=a=>T(-1))},{default:n(()=>t[1]||(t[1]=[u("新增")])),_:1}),o(s,{onClick:D},{default:n(()=>t[2]||(t[2]=[u("保存")])),_:1}),o(s,{onClick:$},{default:n(()=>t[3]||(t[3]=[u("取消")])),_:1}),o(s,{"router-link":{name:"home-page"}},{default:n(()=>t[4]||(t[4]=[u("返回")])),_:1})]),_:1}),o(B,{border:"","show-overflow":"","keep-source":"",ref_key:"tableRef",ref:y,"max-height":"600",data:N.value,loading:x.value,"row-config":{isCurrent:!0,isHover:!0},"edit-rules":I.value,"edit-config":{trigger:"click",mode:"cell",showStatus:!0}},{default:n(()=>[o(m,{field:"deploymentId",title:"deployment",sortable:"","edit-render":{autofocus:".vxe-input--inner",defaultValue:c.deploymentId},visible:!1},{edit:n(({row:a})=>[o(v,{modelValue:a.deploymentId,"onUpdate:modelValue":l=>a.deploymentId=l,type:"text",readonly:"true"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["edit-render"]),o(m,{field:"ticketNo",title:"ticket",sortable:"","edit-render":{autofocus:".vxe-input--inner"},width:"150"},{edit:n(({row:a})=>[o(v,{modelValue:a.ticketNo,"onUpdate:modelValue":l=>a.ticketNo=l,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"ticketTitle",title:"ticket标题",sortable:"","edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:a})=>[o(v,{modelValue:a.ticketTitle,"onUpdate:modelValue":l=>a.ticketTitle=l,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"ticketUrl",title:"ticket详情",sortable:"","edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:a})=>[o(v,{modelValue:a.ticketUrl,"onUpdate:modelValue":l=>a.ticketUrl=l,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"ticketType",title:"ticket类别",sortable:"","edit-render":{autofocus:".vxe-input--inner"},width:"250"},{edit:n(({row:a})=>[o(v,{modelValue:a.ticketType,"onUpdate:modelValue":l=>a.ticketType=l,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"active",title:"操作",width:"350"},{default:n(({row:a})=>[a.id?(U(),H("div",Q,[o(s,{mode:"text",status:"error",onClick:l=>R(a.id)},{default:n(()=>t[5]||(t[5]=[u("删除")])),_:2},1032,["onClick"]),o(s,{mode:"text",onClick:l=>q(a)},{default:n(()=>t[6]||(t[6]=[u("查看test case")])),_:2},1032,["onClick"]),o(s,{mode:"text",content:"导出case"},{dropdowns:n(()=>[o(s,{mode:"text",onClick:l=>C(a,1)},{default:n(()=>t[7]||(t[7]=[u("SIT")])),_:2},1032,["onClick"]),o(s,{mode:"text",onClick:l=>C(a,2)},{default:n(()=>t[8]||(t[8]=[u("UAT")])),_:2},1032,["onClick"])]),_:2},1024)])):L("",!0)]),_:1})]),_:1},8,["data","loading","edit-rules"])])]),_:1})]),_:1})}}};export{Z as default};
