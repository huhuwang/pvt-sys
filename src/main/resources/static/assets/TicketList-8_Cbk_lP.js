import{r as v,j as A,k as j,f as H,w as n,n as _,V as d,d as i,o as C,b as o,a as f,s as V,p as u,c as L,v as z,q as G}from"./index-DkAa4VJT.js";import{_ as J}from"./LoginOut-ChvC3TuR.js";const K={class:"row-wrapper"},P={class:"mybg"},Q={class:"mybg"},W={class:"mybg"},X={key:0},te={__name:"TicketList",setup(Y){const U=G(),y=v(),N=v(),x=v(!1),T=v([{label:"Bug Fix",value:"Bug Fix"},{label:"Enhancement",value:"Enhancement"},{label:"Tech_Uplift",value:"Tech_Uplift"},{label:"Others",value:"Others",disabled:!0}]),c=A({deploymentId:history.state.deploymentId,applicationName:null,deploymentName:null,deploymentDate:null}),b=async()=>{x.value=!0,await _.get(`ticket/queryTicketByDeployment/${c.deploymentId}`).then(e=>{N.value=e}).catch(e=>{d.modal.message({content:e,status:"error"})}).finally(()=>{x.value=!1})},w=()=>{_.get(`deployment/query/${c.deploymentId}`).then(e=>{c.applicationName=e.applicationName,c.deploymentName=e.deploymentName,c.deploymentDate=e.deploymentDate}).catch(e=>{d.modal.message({content:e,status:"error"})})},$=async()=>{const e=y.value;e&&await d.modal.confirm("您确定要还原数据吗?")==="confirm"&&await e.revertData()},I=async()=>{const e=y.value;if(e){const{row:t}=await e.insertAt({});await e.setEditCell(t,"name")}},D=v({ticketNo:[{required:!0,message:"必须填写ticketNo"}],ticketTitle:[{required:!0,message:"必须填写ticket标题"}]}),R=async()=>{const e=y.value;if(e)if(await e.validate())d.modal.message({status:"error",content:"校验不通过！"});else{const{insertRecords:r,updateRecords:p}=e.getRecordset(),g=r.concat(p);_.post("ticket/add",g).then(s=>{d.modal.message({content:"保存成功",status:"success"}),b()}).catch(s=>{d.modal.message({content:s,status:"error"})})}},E=e=>{d.modal.confirm({title:"操作提示",content:"请您确认是否删除？",onConfirm:()=>{_.delete(`ticket/delete/${e}`,{}).then(t=>{d.modal.message({content:"删除成功",status:"success"}),b()}).catch(t=>{d.modal.message({content:t,status:"error"})})}})},B=e=>{const t={ticketNo:e.ticketNo,ticketId:e.id};U.push({name:"case-list",state:t})},h=(e,t)=>{_.get(`download/us?ticketNo=${e.ticketNo}&env=${t}`).then(r=>{d.saveFile({filename:e.ticketNo,type:"xlsx",content:r})}).catch(r=>{d.modal.message({content:r,status:"error"})})};return j(()=>{b(),w()}),(e,t)=>{const r=i("vxe-layout-header"),p=i("vxe-col"),g=i("vxe-row"),s=i("vxe-button"),q=i("vxe-toolbar"),k=i("vxe-input"),m=i("vxe-column"),F=i("vxe-select"),M=i("vxe-table"),O=i("vxe-layout-body"),S=i("vxe-layout-container");return C(),H(S,{vertical:""},{default:n(()=>[o(r,{fixed:"",style:{"background-color":"#a6c9ed"}},{default:n(()=>[o(J)]),_:1}),o(O,null,{default:n(()=>[f("div",null,[f("div",K,[o(g,{gutter:"[100,100]"},{default:n(()=>[o(p,{span:"8"},{default:n(()=>[f("div",P,"应用: "+V(c.applicationName),1)]),_:1}),o(p,{span:"8"},{default:n(()=>[f("div",Q,"发布名称:"+V(c.deploymentName),1)]),_:1}),o(p,{span:"8"},{default:n(()=>[f("div",W,"发布时间:"+V(c.deploymentDate),1)]),_:1})]),_:1})]),o(q,null,{buttons:n(()=>[o(s,{onClick:t[0]||(t[0]=l=>I(-1))},{default:n(()=>t[1]||(t[1]=[u("新增")])),_:1}),o(s,{onClick:R},{default:n(()=>t[2]||(t[2]=[u("保存")])),_:1}),o(s,{onClick:$},{default:n(()=>t[3]||(t[3]=[u("取消")])),_:1}),o(s,{"router-link":{name:"home-page"}},{default:n(()=>t[4]||(t[4]=[u("返回")])),_:1})]),_:1}),o(M,{border:"","show-overflow":"","keep-source":"",ref_key:"tableRef",ref:y,"max-height":"600",data:N.value,loading:x.value,"row-config":{isCurrent:!0,isHover:!0},"edit-rules":D.value,"edit-config":{trigger:"click",mode:"cell",showStatus:!0}},{default:n(()=>[o(m,{field:"deploymentId",title:"deployment",sortable:"","edit-render":{autofocus:".vxe-input--inner",defaultValue:c.deploymentId},visible:!1},{edit:n(({row:l})=>[o(k,{modelValue:l.deploymentId,"onUpdate:modelValue":a=>l.deploymentId=a,type:"text",readonly:"true"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["edit-render"]),o(m,{field:"ticketNo",title:"ticket",sortable:"","edit-render":{autofocus:".vxe-input--inner"},width:"150"},{edit:n(({row:l})=>[o(k,{modelValue:l.ticketNo,"onUpdate:modelValue":a=>l.ticketNo=a,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"ticketTitle",title:"ticket标题",sortable:"","edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:l})=>[o(k,{modelValue:l.ticketTitle,"onUpdate:modelValue":a=>l.ticketTitle=a,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"ticketUrl",title:"ticket详情",sortable:"","edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:l})=>[o(k,{modelValue:l.ticketUrl,"onUpdate:modelValue":a=>l.ticketUrl=a,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(m,{field:"ticketType",title:"ticket类别",sortable:"","edit-render":{autofocus:".vxe-input--inner"},width:"250"},{edit:n(({row:l})=>[o(F,{modelValue:l.ticketType,"onUpdate:modelValue":a=>l.ticketType=a,options:T.value},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),o(m,{field:"active",title:"操作",width:"350"},{default:n(({row:l})=>[l.id?(C(),L("div",X,[o(s,{mode:"text",status:"error",onClick:a=>E(l.id)},{default:n(()=>t[5]||(t[5]=[u("删除")])),_:2},1032,["onClick"]),o(s,{mode:"text",onClick:a=>B(l)},{default:n(()=>t[6]||(t[6]=[u("查看test case")])),_:2},1032,["onClick"]),o(s,{mode:"text",content:"导出case"},{dropdowns:n(()=>[o(s,{mode:"text",onClick:a=>h(l,1)},{default:n(()=>t[7]||(t[7]=[u("SIT")])),_:2},1032,["onClick"]),o(s,{mode:"text",onClick:a=>h(l,2)},{default:n(()=>t[8]||(t[8]=[u("UAT")])),_:2},1032,["onClick"])]),_:2},1024)])):z("",!0)]),_:1})]),_:1},8,["data","loading","edit-rules"])])]),_:1})]),_:1})}}};export{te as default};
