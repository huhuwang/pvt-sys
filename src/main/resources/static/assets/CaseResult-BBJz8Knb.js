import{r as f,j as P,k as $,f as j,w as o,n as y,V as _,d,o as A,b as e,a as H,p as c,s as m,q as O}from"./index-Bcze8WgH.js";import{_ as E}from"./LoginOut-cJFqAwEf.js";const Q={__name:"CaseResult",setup(G){const T=O(),x=f([]),u=f({}),s=f({}),k=f(!1),V=f([{label:"PASS",value:1},{label:"NO PASS",value:2}]),I=a=>{if(a==1)return"ticket";if(a==2)return"health check"},C=a=>{switch(a){case 1:return"Urgent";case 2:return"Highest";case 3:return"High";case 4:return"Low";case 5:return"Lowest";case 6:return"Blocker";case 7:return"Critical";case 8:return"Major";case 9:return"Minor";case 10:return"Trivial"}},n=P({resultId:history.state.resultId,deploymentId:history.state.deploymentId,ticketId:history.state.ticketId,env:history.state.env,device:history.state.device,nextCase:null}),g=async()=>{await y.get(`result/query/${n.resultId}`).then(a=>{s.value=a,u.value=a.testCase,k.value=(a.category&4)>0,x.value=a.documents.map(({documentName:t,documentType:r,scaleSize:l,url:R,id:i})=>({name:t,type:r,size:l,url:R,documentId:i})),U()}).catch(a=>{_.modal.message({content:a,status:"error"})})},U=()=>{let a=f({});a.value.env=n.env,a.value.device=n.device,a.value.ticketNo=u.value.ticketNo,y.post("result/query/case",a.value).then(t=>{const r=t.findIndex(l=>l==n.resultId);r==t.length-1?n.nextCase=t[0]:n.nextCase=t[r+1]}).catch(t=>{_.modal.message({content:t,status:"error"})})},w=()=>{s.value.testCase.id=u.value.id,s.value.documents=x.value.map(({documentId:a,url:t})=>({id:a,url:t})),y.post("result/add",s.value).then(a=>{_.modal.message({content:"保存成功",status:"success"})}).catch(a=>{_.modal.message({content:a,status:"error"})})},D=()=>{const a={ticketNo:u.value.ticketNo,ticketId:n.ticketId};T.push({name:"case-list",state:a})},N=async({file:a,option:t})=>{const r=new FormData;r.append("file",a),r.append("resultId",n.resultId),r.append("deploymentId",n.deploymentId),await y.post("document/upload",r).then(l=>{t.url=l.url,t.documentId=l.id}).catch(l=>{_.modal.message({content:l,status:"error"})})},S=async({option:a})=>{await y.delete(`document/delete/${a.documentId}`).then(t=>{}).catch(t=>{_.modal.message({content:t,status:"error"})})},q=()=>{w(),n.resultId=n.nextCase,g()};return $(()=>{g()}),(a,t)=>{const r=d("vxe-layout-header"),l=d("vxe-form-item"),R=d("vxe-form"),i=d("vxe-option"),z=d("vxe-select"),b=d("vxe-textarea"),F=d("vxe-radio-group"),h=d("vxe-button"),M=d("vxe-upload"),B=d("vxe-layout-body"),L=d("vxe-layout-container");return A(),j(L,{vertical:""},{default:o(()=>[e(r,{fixed:"",style:{"background-color":"#a6c9ed"}},{default:o(()=>[e(E)]),_:1}),e(B,null,{default:o(()=>[H("div",null,[e(R,{border:"","title-background":"","vertical-align":"center","title-width":"120",data:u.value},{default:o(()=>[e(l,{title:"description",field:"description",span:"24"},{default:o(()=>[c(m(u.value.description),1)]),_:1}),e(l,{title:"summary",field:"summary",span:"24"},{default:o(()=>[c(m(u.value.summary),1)]),_:1}),e(l,{title:"expected result",field:"expectedResult",span:"24"},{default:o(()=>[c(m(u.value.expectedResult),1)]),_:1}),e(l,{title:"step",field:"step",span:"24"},{default:o(()=>[c(m(u.value.step),1)]),_:1}),e(l,{title:"priority",field:"priority",span:"24"},{default:o(()=>[c(m(C(u.value.priority)),1)]),_:1}),e(l,{title:"reporter",field:"createUser",span:"24"},{default:o(()=>[c(m(u.value.createUser),1)]),_:1}),e(l,{title:"verifier",field:"updateUser",span:"24"},{default:o(()=>[c(m(u.value.updateUser),1)]),_:1}),e(l,{title:"type",field:"type",span:"24"},{default:o(()=>[c(m(I(u.value.type)),1)]),_:1}),e(l,{title:"env",field:"env",span:"24"},{default:o(()=>[c(m(s.value.env),1)]),_:1}),e(l,{title:"device",field:"device",span:"24"},{default:o(()=>[c(m(s.value.device),1)]),_:1})]),_:1},8,["data"]),e(R,{border:"","title-background":"","vertical-align":"center","title-width":"120",data:s.value,onSubmit:w},{default:o(()=>[e(l,{title:"RT flow",field:"rtFlow",span:"24","item-render":{},visible:k.value},{default:o(v=>[e(z,{modelValue:s.value.rtFlow,"onUpdate:modelValue":t[0]||(t[0]=p=>s.value.rtFlow=p),placeholder:"RT模板",size:"medium"},{default:o(()=>[e(i,{value:"RT1",label:"RT1"}),e(i,{value:"RT2",label:"RT2"}),e(i,{value:"RT3",label:"RT3"}),e(i,{value:"RT4",label:"RT4"}),e(i,{value:"RT5",label:"RT5"}),e(i,{value:"RT6",label:"RT6"}),e(i,{value:"RT7",label:"RT7"}),e(i,{value:"RT8",label:"RT8"})]),_:1},8,["modelValue"])]),_:1},8,["visible"]),e(l,{title:"test data",field:"testData",span:"24","item-render":{}},{default:o(v=>[e(b,{modelValue:s.value.testData,"onUpdate:modelValue":t[1]||(t[1]=p=>s.value.testData=p),placeholder:"test data",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(l,{title:"actual result",field:"actualResult",span:"24","item-render":{}},{default:o(v=>[e(b,{modelValue:s.value.actualResult,"onUpdate:modelValue":t[2]||(t[2]=p=>s.value.actualResult=p),placeholder:"actual result",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(l,{title:"result",field:"result",span:"24","item-render":{}},{default:o(v=>[e(F,{modelValue:s.value.result,"onUpdate:modelValue":t[3]||(t[3]=p=>s.value.result=p),options:V.value},null,8,["modelValue","options"])]),_:1}),e(l,{title:"remark",field:"remark",span:"24","item-render":{}},{default:o(v=>[e(b,{modelValue:s.value.remark,"onUpdate:modelValue":t[4]||(t[4]=p=>s.value.remark=p),placeholder:"remark",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(l,{align:"center",span:"24","item-render":{}},{default:o(()=>[e(h,{type:"submit",status:"primary",content:"提交"}),e(h,{type:"reset",content:"重置"}),e(h,{content:"返回",onClick:D}),e(h,{content:"下一条",status:"primary",onClick:q})]),_:1})]),_:1},8,["data"]),e(M,{"key-field":"documentId",modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=v=>x.value=v),mode:"image","limit-count":15,multiple:"","show-progress":"","upload-method":N,"remove-method":S},null,8,["modelValue"])])]),_:1})]),_:1})}}};export{Q as default};
