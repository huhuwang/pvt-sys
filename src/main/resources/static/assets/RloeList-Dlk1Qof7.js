import{r as s,k as T,d as u,o as y,c as C,b as a,w as l,p as v,v as A,a as L,n as d,V as n}from"./index-DkAa4VJT.js";const O={key:0},z={__name:"RloeList",setup(S){const p=s(),w=s(),x=s(!1),f=async()=>{x.value=!0,await d.get("role/list").then(t=>{w.value=t}).catch(t=>{n.modal.message({content:t,status:"error"})}).finally(()=>{x.value=!1})},$=async()=>{const t=p.value;t&&await n.modal.confirm("您确定要还原数据吗?")==="confirm"&&await t.revertData()},N=async()=>{const t=p.value;if(t){const{row:e}=await t.insertAt({});await t.setEditCell(e,"name")}},R=s({roleName:[{required:!0,message:"this field is required"}]}),U=async()=>{const t=p.value;if(t)if(await t.validate())n.modal.message({status:"error",content:"校验不通过！"});else{const{insertRecords:o,updateRecords:h}=t.getRecordset(),_=o.concat(h);d.post("role/add",_).then(m=>{n.modal.message({content:"保存成功",status:"success"}),f()}).catch(m=>{n.modal.message({content:"保存失败",status:"error"})})}},D=t=>{n.modal.confirm({title:"操作提示",content:"请您确认是否删除？",onConfirm:()=>{d.delete(`role/delete/${t}`,{}).then(e=>{n.modal.message({content:"删除成功",status:"success"}),f()}).catch(e=>{n.modal.message({content:"删除失败",status:"error"})})}})},V=s(),g=s(!1),c=s([]),b=s([]),k=s("权限"),E=async t=>{c.value=[],k.value=`${t.roleName}权限设置`,V.value=t.id,await d.get(`permission/query/${t.id}`).then(e=>{for(let o=0;o<e.length;o++)c.value[o]=`${e[o].id}`;g.value=!0}).catch(e=>{n.modal.message({content:e,status:"error"})})},P=async()=>{b.value=[],d.get("permission/list").then(t=>{for(let e=0;e<t.length;e++){const o={label:`${t[e].permissionName}`,value:`${t[e].id}`};b.value[e]=o}}).catch(t=>{n.modal.message({content:t,status:"error"})})},q=async()=>{let t=s({});t.value.roleId=V.value,t.value.permissionIds=c.value,d.post("role/permission/setting",t.value).then(e=>{f()}).catch(e=>{n.modal.message({content:e,status:"error"})})};return T(()=>{f(),P()}),(t,e)=>{const o=u("vxe-button"),h=u("vxe-toolbar"),_=u("vxe-input"),m=u("vxe-column"),B=u("vxe-checkbox-group"),I=u("vxe-drawer"),M=u("vxe-table");return y(),C("div",null,[a(h,null,{buttons:l(()=>[a(o,{onClick:N},{default:l(()=>e[2]||(e[2]=[v("新增")])),_:1}),a(o,{onClick:U},{default:l(()=>e[3]||(e[3]=[v("保存")])),_:1}),a(o,{onClick:$},{default:l(()=>e[4]||(e[4]=[v("取消")])),_:1})]),_:1}),a(M,{border:"","show-overflow":"","keep-source":"",ref_key:"tableRef",ref:p,"max-height":"700",data:w.value,loading:x.value,"edit-rules":R.value,"edit-config":{trigger:"click",mode:"cell",showStatus:!0}},{default:l(()=>[a(m,{field:"roleName",title:"角色名称",sortable:"","edit-render":{autofocus:".vxe-input--inner"},width:"150"},{edit:l(({row:r})=>[a(_,{modelValue:r.roleName,"onUpdate:modelValue":i=>r.roleName=i,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(m,{field:"roleDescribe",title:"角色描述",sortable:"","edit-render":{autofocus:".vxe-input--inner"}},{edit:l(({row:r})=>[a(_,{modelValue:r.roleDescribe,"onUpdate:modelValue":i=>r.roleDescribe=i,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(m,{field:"active",title:"操作",width:"350"},{default:l(({row:r})=>[r.id?(y(),C("div",O,[a(o,{mode:"text",status:"error",onClick:i=>D(r.id)},{default:l(()=>e[5]||(e[5]=[v("删除")])),_:2},1032,["onClick"]),a(o,{mode:"text",onClick:i=>E(r)},{default:l(()=>e[6]||(e[6]=[v("修改权限")])),_:2},1032,["onClick"])])):A("",!0),a(I,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=i=>g.value=i),width:300,"show-footer":"","show-confirm-button":"","show-cancel-button":"",mask:!1,title:k.value,onConfirm:q},{default:l(()=>[L("div",null,[a(B,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=i=>c.value=i),options:b.value},null,8,["modelValue","options"])])]),_:1},8,["modelValue","title"])]),_:1})]),_:1},8,["data","loading","edit-rules"])])}}};export{z as default};
